<script src="/javascripts/project_workload.js" type="text/javascript"></script>


<%= link_to_function('Projects filter', "Effect.toggle('filters','blind');",{:class=>"btnlnk"}) %>
<%= link_to('Switch to person view', {:controller=>'workloads'}, {:class=>'btnlnk'}) %>
<%= image_tag('loading.gif', :id=>'loading', :style=>"display:none;position:fixed;left:700px;") %>
<% if !session['workload_project_ids'] or session['workload_project_ids'].size <= 1 %>
<%= link_to_function('Add a person', "wl_add_line()", :class=>"btnlnk") %>
<% else %>
<a style="color:#FA5858">(Add a person is disabled when more than one project is selected)</a>
<% end %>
<!--<div id="edit_line"></div>-->

  <div id="filters" style="display:none;border:1px solid #DDD;margin-top:25px;background: #EEE;">

  <%# form_remote_tag(:url=>{:action=>'change_workload'}) do %>
  <% form_tag(:action=>'index') do %>
  <table>
    <tr valign="top"><td>
    <b>Projects</b><br/>
    <% if @projects %>
      <% for p in @projects %>
        <%= check_box_tag('project_ids[]', p.id, session['workload_project_ids'].include?(p.id.to_s)) %><%= "#{p.name} (#{p.wl_lines.size})"%><br/>
      <% end %>
    <% end %>
    </td></tr>
  </table>
  <%= submit_tag('Filter') %>
  <% end %>
  </div>
  <br/>

<% if session['workload_project_ids'] and session['workload_project_ids'].size > 0 %>

<%= render(:partial=>"workload") %>

<script>
  set_fixed_header(<%=APP_CONFIG['workloads_max_height']%>);
  new Draggable(wl_line_add_form); // does not mix well with scrollbar
</script>

<% end %>